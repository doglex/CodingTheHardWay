[TOC]
<h1> 计算机网络 </h1>

#概念
计算机网络：通过通信设备与线路连接起来，由软件实现`资源共享`和`信息传递`的计算机系统。
+ 互连：连通
+ 自治：无主从关系
+ 资源共享
+ 分布式处理
+ 可靠性
+ 负载均衡

网路组成
+ 硬件
+ 软件
+ 协议

工作方式
+ 边缘部分(端系统)：用户可以直接使用 C/S, P2P
+ 核心部分: 为边缘服务，包括交换机、路由器等

功能组成
+ `通信子网`：实现数据通信，即`传输层以下`
+ `资源子网`：实现数据处理(共享)， 即`会话层以上`

网路分类
+ 按范围： 广域网WAN(交换技术)、城域网MAN、局域网WAN(广播技术)、个人局域网PAN
+ 使用者：共用网、专用网(军队、银行)
+ 交换技术：电路交换、报文交换、分组交换
+ 拓扑：总线型、星型、环形、网状(广域网)
+ 传输技术：广播式(共享公共信道)、点对点(分组存储转发+路由选择)

标准
+ 法定标准：比如OSI
+ 事实标准：TCP/IP
+ 自己怎么提RFC：Request For Comments：(1)搞个草案(2)建议标准~~(3)草案标准~~(3)因特网标准
+ ISO标准化组织，ITU指定通信规则，IEEE是学术机构，IETF是工程任务组

性能指标
+ 速率： bps, Mbps (比特率，不是Byte，是bit)
+ `带宽` ：模拟信号时指频率Hz，数字信号时指`最高速率`。也是bps
+ 吞吐量：一样的，也是bps
+ 时延：从链路一端到另一端的 秒数 = 发送时延(也叫传输时延)+传播时延+排队时延+处理时延
+ 时延带宽积：传播时延 x 带宽  ，表示了信息量是多少bit。就是有多少个bit在路上
+ 往返时延RTT： 发送方得到反馈的时间差。RTT越大，在收到确认前，可以发送更多时间。RTT = 2x传播时延+末端处理时延

利用率
+ 信道利用率：有数据通过时间占比
+ 网络利用率：信道利用率加权平均

网络分层的概念
+ 实体：同一层的实体称为`对等实体`
+ 协议：对等实体间的数据交换规则 (水平方向)
+ 接口：上层使用下层的入口
+ 服务：下层提供相邻上层的功能(垂直方向)
+ 网络分层是按照功能来分的
+ 7层模型：上面4层应用层、表示层、会话层、传输层看起来是`端到端`(端口)；下面3层网络层、链路层、物理层看起来是`点到点`，因为只负责传输不管传到哪里
+ 应用层：FTP、SMTP、HTTP
+ 表示层：数据格式转换、加密解密、数据压缩恢复
+ 会话层:有序传输、建立同步(SYN)。建立、管理、终止会话。校验点/同步点恢复通信。
+ 传输层：端到端通信，传报文段或者用户数据报。可靠传输、不可靠传输，差错控制、流量控制、复用分用。
+ 网络层：传输数据报。路由选择、流量控制、差错控制、拥塞控制
+ 数据链路层：传输帧。成帧、流量控制、差错控制、(信道)访问/接入控制
+ 物理层：传输比特。实现透明传输。定义接口特性。定义传输模式(单工、半双工、双工)、比特同步、比特编码

五层模型 OSI+TCP/IP模型
+ 应用层(无连接)
+ 传输层(无连接+面向连接)
+ 网络层
+ 数据链路层
+ 物理层

# 数据通信
+ 数据：有意义的符号序列。
+ 信号：数据传输过程中的存在形式。(数字信号离散，模拟信号连续)
+ 信源：生产数据的源头。
+ 信宿：消费数据的终点。
+ 信道：信号的传输媒介。
+ 单工：只能单向，一条信道
+ 半双工：同时只能单向，两条信道
+ 双工：可以同时发送接收，两条信道
+ 串行传输：单个bit通过单个信道。速度慢费用低，适合远距离
+ 并行传输：多个信道同时传多个bit。速度快费用高，适合近距离
+ 码元： 固定时长下的信号波形。可以携带多个bit
+ 码元宽度： 这个固定时长
+ 码元速率(即调制速率、符号速率、脉冲个数)：单位是波特 Baud /s = n bps . （比如1波特带有n个比特）
+ 基带信号：来自信源的信号，近传输用
+ 宽带信号：调制后放到一个特定频率的信号，远传输用

数字数据编码为数字信号
+ 非归零编码 NRZ
+ 归零编码 RZ
+ 曼切斯特编码
+ 反向不归零编码 NRZI
+ 差分曼切斯特编码
+ 4B/5B编码

数字数据调制为模拟信号
+ ASK调幅
+ FSK调频
+ PSK调相
+ QAM调幅+调相

模拟数据编码为数字信号
+ PCM 脉码调制：抽样、量化、编码

模拟信号调制为模拟信号
+ 频分复用

# 香农定理
+ 失真原因：码元传输速率、信号传输距离、噪声干扰、传输媒体质量
+ 失真现象：码间串扰，收到的信号波形失去了码元之间界限不清
+ 信道带宽：最高频率和最低频率之差
+ 奈氏准则：在理想低通(无噪声，带宽受限)下，避免码间串扰的极限传输速率是 2W Baud ， 即2W(logV/log2) bps。 W是信道带宽(Hz).
+ 因此可以通过提高一个码元表示的bit量来提高速率
+ 香农定理：带宽受限有噪声，信道极限传输速率是 W(log(1+S/N)/ log2) bps 。 S是信号平均功率，N是高斯噪声功率
+ 因为必有噪声，所以实际传输速率有上限。要保证信噪比

# 传输介质

导向性介质
+ 双绞线：里面有铜
+ 同轴电缆
+ 光纤：传递光脉冲，频率大

非导向性介质
+ 无线电波：每个方向都有，只要在通信距离内，穿透能力也强
+ 微波：固定直线方向。频段范围非常宽、数据率高：卫星通信、地面微波接力
+ 红外线、激光：需要转特殊格式

# 物理层设备
+ 中继器：再生数字信号。从而增加传输距离。需要两端网络完全相同。不能用太多，因为有延迟。
+ 集线器(多口中继器)：放大信号并转发。不能分割冲突域，上面的主机平分带宽。

# 数据链路层
+ 结点：主机、路由器
+ 链路： 两个结点间的物理通道
+ 数据链路： 两个结点间的逻辑通道
+ 帧： 链路层的协议数据单元、封装网络层数据报
+ 数据链路层：为网络层提供服务(无确认无连接服务、有确认无连接服务、有确认面向连接服务)。加强物理层传输原始比特率的功能。组帧。流量控制。差错控制。

组帧
+ 封装成帧:添加帧首部、帧尾部。
+ 透明传输：链路层看不见具体是什么比特的，都能通过
+ 字符计数法、字符填充法(就是转义这些SOH,start of header;EOT, end of transmission)，零比特填充法、违规编码法。

差错
+ 原因：电气特性导致全局差错(随机噪声)，外界原因导致局部差错(冲击噪声)
+ 位错：比特位出错
+ 帧错：丢失、重复、失序
+ 检错编码：奇偶校验吗(数1的个数)、循环冗余码CRC(多项式取余数)
+ 纠错编码：海明码(冗余位可以纠回有限错误)

> 这些协议无所谓在哪层，本来放链路层的，现在让传输层去实现了，让链路层更快一些了
`流量控制`
+ 原因：较高发送速度和较低接收能力不匹配，缓冲不来
+ 停止--等待协议：每发一帧，就等确认，确认后再接着发
+ 滑动窗口协议：后退N帧(GBN), 选择重传协议(SR)：收到一个确认，发送窗口可以往前移动一格。接收窗口=1是GBN，>1是SR
+ 可靠传输：接收的就是发送的东西

停止--等待协议
+ 每发一帧，就等确认，确认后再接着发
+ 每次发的时候有个计时器(比平均RTT长)，超出计时器就重发
+ 发送时需要有编号，确认收到需要有编号，这样对上
+ 收到重复的丢弃
+ ACK迟到了,来晚了的话发送方不管了，丢弃就好了
+ 优点是简单，缺点是信道利用率太低

GBN后退N帧协议
+ 发送窗口：发送发维持一组允许发送的帧的序号。
+ 接收窗口：接收发一组连续的允许接收帧的序号。
+ 发送方需要响应：(1)上层要发时，如果窗口满了先缓存数据(2)收到ACK时，`累积确认`(表示序号比n小的都已经确认了)，并且可以向前滑动发送了
 (3)超时事件，重传所有已发送但是未确认的帧。
+ 接收方做的事：需要`按序接收`，如果接收到了不连续的帧，后面的全部丢弃，并且重新ACK上一次正确的帧。
+ 若采用n个比特对帧编号，窗口大小应该在1<W<2^n-1。 太大的话没法区别新帧和旧帧，即排序不够用了。
+ 性能：(1)相比停止--等待协议，提高了信道利用率(2)重传时可能丢掉很多，可能使效率低。

SR 选择重传协议：改进GBN
+ 可以缓存乱序到达。设置单个确认，加大接收窗口，设置接收缓存。
+ 发送方：(1)滑动发送的时候，可能滑一大块，因为乱序确认，只要确认的都可以滑过去了。(2)每个帧有计时器，超时时重发那个帧就好了。
+ 接收方：如果接收窗口内的都可以接受，不管是否按序。那帧好了，就可以滑到下一个没好的地方。
+ 发送窗口比接收窗口大来不及，小没意义。WT=WR=2^(n-1)

信道划分介质访问控制
+ 点对点链路：两个相邻节点之间，没有第三者，比如PPP。常用于广域网。
+ 广播式链路：所有节点共享介质。常用于局域网。有总线型、星型。
+ 访问控制：共享信道上，两对节点间不要相互干扰。
+ 静态划分信道：频分多路复用FDM，时分多路复用TDM(统计时分复用STDM，都用的多给时间片)，波分多路复用WDM，码分多路复用CDM(正交码片，相加分离，做内积)。
+ 动态分配信道：轮询(令牌传递协议)，随机访问介质控制(ALOHA,CSMA,CSMA/CD, CSMA/CA)。随机的需要协调

ALOHA协议：不听就说
+ 想发就发，不管别人
+ 冲突重发
+ 在接收方检测差错。等待超时一个随机时间再重传

时隙ALOHA协议(改进)
+ 控制想发就发的随意性
+ 分成相等时间片
+ 发生冲突需要等待时间片

CSMA协议 (Carrier sense multiple access)：先听再说
+ CS:载波监听。检测到电压摆动值过大，认为别人在传数据，就先不发等空闲。
+ MA：多点接入
+ 推迟策略：(1)1-坚持CSMA：空闲直接传不等，忙的话就等空闲立刻就传，冲突的话(没收到确认)就等随机长时间再监听。
(2)非坚持CSMA：忙的话就等一个随机的时间后再监听。
(3)p-坚持CSMA：空闲时以p概率直接传输；1-p概率等待到下一个时间片；忙的话等待随机时间后再监听。这是最好的。

CSMA/CD协议：先听再说、边听边说、碰撞检测 Collision Detection
+ MA:总线型,有线网络
+ CD: 半双工
+ 为什么还会冲突：是因为电磁波在总线上是有限速度的。
+ 争用期/冲突窗口/碰撞窗口：最长需要 2T,2倍传播时延，才能知道碰撞了没。最短需要0.
+ 重传/退避时间：截断二进制指数规避算法。2rT, r是重0-2^k-1取的，k是第k次重传。最多重传16次。
+ 最小帧长：很短的帧可能碰撞了也不知道，或者之后才知道。所以帧要够大。以太网是64B。

CSMA/CA :想听再说，有礼貌的，碰撞避免 Collision Avoidance
+ 用于无线局域网。因为用CD的话没法全面360度检测电，或者隐蔽的站没法检测到信号。
+ 发送前检测空闲
+ 空闲则发送 RTS(Request to send) 信号，包含发射端地址、接收端地址、下一份数据持续发送时间。信道忙则等待
+ 接收端响应CTS(Clear to send)
+ 发送端收到CTS，开始发送数据帧。并且`预约信道`，别人可以知道要等多久
+ 接收端用CRC检验，响应ACK
+ 发送方没有收到ACK，则和CSMA/CD进行指数退避

轮询协议
+ 主节点轮流邀请从节点发送数据
+ 问题：轮询开销、等待延迟、单点故障

令牌传递协议
+ 令牌：一个特殊格式的MAC控制帧、不含任何信息
+ 只有持有令牌的机器可以发，令牌环无碰撞。发完给下一个人令牌
+ 问题：令牌开销、等待延迟、单点故障
+ 常用物理星型拓扑、逻辑环形拓扑
+ 常用于负载较重，通信量大的网络。这样不用反复交换令牌















